<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <title>ネズミ2Dスクロールチュー</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #88d;
        }

        canvas {
            display: block;
            background: #cce;
        }
    </style>
</head>

<body>
    <canvas id="gameCanvas"></canvas>
    <script src="mouse-engine.js"></script>
    <script>
        Mouse.init("gameCanvas", window.innerWidth, window.innerHeight);
        Mouse.setupUIEvents();

        // プレイヤー作成チュー
        const player = Mouse.createRigidBody(100, 100, 40, 40, 0, 0, null, false, false);
        player.color = "#f55";
        Mouse.followCamera(player);

        // 床作成チュー
        for (let i = 0; i < 20; i++) {
            Mouse.createRigidBody(i * 200, 500, 200, 50, 0, 0, null, false, true);
        }

        // 仮想パッドボタンチュー
        const leftBtn = {
            x: 50, y: Mouse.height - 120, width: 60, height: 60,
            draw(ctx) {
                ctx.fillStyle = "#444";
                ctx.beginPath();
                ctx.arc(this.x + 30, this.y + 30, 30, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = "#fff";
                ctx.font = "30px sans-serif";
                ctx.fillText("←", this.x + 15, this.y + 40);
            },
            onClick() { movingLeft = true; },
            onRelease() { movingLeft = false; }
        };

        const rightBtn = {
            x: 140, y: Mouse.height - 120, width: 60, height: 60,
            draw(ctx) {
                ctx.fillStyle = "#444";
                ctx.beginPath();
                ctx.arc(this.x + 30, this.y + 30, 30, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = "#fff";
                ctx.font = "30px sans-serif";
                ctx.fillText("→", this.x + 15, this.y + 40);
            },
            onClick() { movingRight = true; },
            onRelease() { movingRight = false; }
        };

        const jumpBtn = {
            x: Mouse.width - 100, y: Mouse.height - 120, width: 60, height: 60,
            draw(ctx) {
                ctx.fillStyle = "#444";
                ctx.beginPath();
                ctx.arc(this.x + 30, this.y + 30, 30, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = "#fff";
                ctx.font = "20px sans-serif";
                ctx.fillText("Jump", this.x + 5, this.y + 40);
            },
            onClick() {
                if (player.onGround) {
                    player.vy = -12;
                }
            }
        };

        Mouse.addUIElement(leftBtn);
        Mouse.addUIElement(rightBtn);
        Mouse.addUIElement(jumpBtn);

        let movingLeft = false;
        let movingRight = false;

        Mouse.loop(() => {
            // 入力処理チュー
            if (Mouse.isKeyPressed("ArrowLeft") || movingLeft) {
                player.vx = -5;
            } else if (Mouse.isKeyPressed("ArrowRight") || movingRight) {
                player.vx = 5;
            } else {
                player.vx = 0;
            }

            if ((Mouse.isKeyPressed(" ") || Mouse.isKeyPressed("ArrowUp")) && player.onGround) {
                player.vy = -12;
            }

            // 描画チュー
            Mouse.clear();
            for (let body of Mouse.rigidBodies) {
                Mouse.drawRigidBody(body, body.color || "blue");
            }

            Mouse.drawUI();
        });

    </script>
</body>

</html>